<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>

        <ui:composition template="../../resources/Template.xhtml">

            <ui:define name="hoja_estilos">
                
            </ui:define>

            <ui:define name="title">
                Producto
            </ui:define>
            <ui:define name="content">


                <h:form id="frmProducto">

                    <p:growl id="growlProducto" globalOnly="true" showDetail="true" autoUpdate="true" />

                    <!-- *********************************FORMULARIO PARA BUSCAR PRODUCTOS*********************************************************** -->

                    <div class="buscar" align="center">

                        <p:panel header="Busqueda de Productos" >

                            <h:panelGrid columns="7" cellpadding="5">

                                <p:outputLabel value="Tipo de Producto" />

                                <p:selectOneMenu id="selectTipoProducto"
                                                 value="#{productoFormBean.tipoId}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue=""></f:selectItem>
                                    <f:selectItems value="#{tipoProductoFormBean.tabla}"
                                                   var="tipos" itemLabel="#{tipos.descripcion}"
                                                   itemValue="#{tipos.idTipoProducto}" />

                                </p:selectOneMenu>



                                <p:outputLabel value="Marca: " />
                                <p:selectOneMenu id="marca" 
                                                 value="#{productoFormBean.marcaId}">
                                    <f:selectItem itemValue="" itemLabel=""></f:selectItem>
                                    <f:selectItems value="#{marcaFormBean.tabla}"
                                                   var="marcas" itemLabel="#{marcas.descripcion}"
                                                   itemValue="#{marcas.idMarca}" />
                                </p:selectOneMenu>

                                <p:outputLabel value="Nombre: " />
                                <p:selectOneMenu id="nombre" 
                                                 value="#{productoFormBean.productoId}">
                                    <f:selectItem itemValue="" itemLabel=""></f:selectItem>
                                    <f:selectItems value="#{productoFormBean.tablaFiltrada}"
                                                   var="productos" itemLabel="#{productos.descripcion}"
                                                   itemValue="#{productos.idProducto}" />
                                </p:selectOneMenu>

                                <p:commandButton id="submit" value="Buscar" actionListener="#{productoFormBean.buscar()}"  ajax="true" update="frmProducto " style="margin-top: 0px;" styleClass="boton">
                                </p:commandButton>           		       

                            </h:panelGrid>

                        </p:panel>

                    </div>
                    <!-- **************************************Boton Alta************************************************ -->



                    <div class="botonAlta">
                        <p:commandButton value="Nuevo" action="#{productoFormBean.preCargarProducto}" update=":frmNuevo" >
                        </p:commandButton>

                    </div>

                    <!-- ******************************************TABLA DE PRODUCTOS********************************************* -->

                    <div class="tabla">	

                        <p:dataTable id="tablaProducto" var="producto" reflow="true" editable="true"
                                     value="#{productoFormBean.tabla}" rows="6" paginator="true" style="margin-bottom:20px">

                            <p:column headerText="Barcode">
                                <p:barcode value="#{productoFormBean.generarCodigo(producto.idProducto)}" type="code128" format="png" width="160"/>
                            </p:column>
                            
                            <p:column headerText="QRcode">
                                <p:barcode value="#{productoFormBean.generarCodigo(producto.idProducto)}" type="qr"/>
                            </p:column>
                            
                            <p:column headerText="Descripcion" > 
                                <p:outputLabel value="#{producto.descripcion}"  />
                            </p:column>

                            <p:column headerText="Tipo de Producto">
                                <p:outputLabel value="#{producto.tipoProducto.descripcion}" />
                            </p:column>

                            <p:column headerText="Marca">
                                <p:outputLabel value="#{producto.marca.descripcion}" />
                            </p:column>

                            <p:column headerText="Stock">
                                <p:outputLabel value="#{producto.stock} #{producto.detalleUnidad.abreviatura}" />
                            </p:column>

                            <p:column headerText="Acciones">

                                <p:commandButton update=":f" oncomplete="PF('dlg').show()"
                                                 icon="ui-icon-search" title="Ver Detalles">
                                    <f:setPropertyActionListener value="#{producto}"
                                                                 target="#{productoFormBean.pb.producto}" />
                                </p:commandButton>


                                <p:commandButton id="btnBajaProducto" icon="ui-icon-closethick"
                                                 oncomplete="PF('confirmarBajaProducto').show()"
                                                 update=":frmConfirmacionBaja"
                                                 actionListener="#{productoFormBean.pb.setProducto(producto)}"
                                                 ajax="true">
                                </p:commandButton>

                            </p:column>

                        </p:dataTable>
                    </div>

                </h:form>


                <!-- **********************POPUP QUE MUESTRA LOS DETALLES DE UN PRODUCTO******************** -->

                <h:form id="f">
                    <p:dialog id="dlg" widgetVar="dlg" header="Detalle del Producto"
                              modal="true" showEffect="explode" hideEffect="explode">

                        <h:panelGrid columns="2">
                            <p:outputLabel value="CODIGO:" />
                            <h:outputText value="#{productoFormBean.pb.producto.idProducto}" />
                            <p:outputLabel value="NOMBRE" />
                            <h:outputText value="#{productoFormBean.pb.producto.descripcion}" />
                            <p:outputLabel value="Tipo" />
                            <h:outputText value="#{productoFormBean.pb.producto.tipoProducto.descripcion}" />
                            <p:outputLabel value="Marca:" /> 
                            <h:outputText value="#{productoFormBean.pb.producto.marca.descripcion}"/>


                            <p:outputLabel value="Detalle Unidad:" />
                            <h:outputText
                                value="#{productoFormBean.pb.producto.detalleUnidad.descripcion}" />

                            <p:outputLabel value="Stock:" />
                            <h:outputText value="#{productoFormBean.pb.producto.stock}" />
                            <p:outputLabel value="ESTADO" />
                            <h:outputText value="#{productoFormBean.pb.producto.estado}" />

                            <p:outputLabel value="Imagen"></p:outputLabel>



                            <p:commandButton type="submit"
                                             onclick="dlg.hide()" value="Aceptar"
                                             ajax="true" update=""></p:commandButton>
                            <p:commandButton value="Modificar" ></p:commandButton>
                        </h:panelGrid>

                    </p:dialog>
                </h:form>


                <!-- **************************************POPUP CONFIRMACION DE BAJA************************************************ -->

                <h:form id="frmConfirmacionBaja">

                    <p:confirmDialog id="dlgConfirmarBajaProducto" 
                                     message="Â¿Esta seguro que desea eliminar el producto?"
                                     header="Eliminar Producto" severity="alert"
                                     widgetVar="confirmarBajaProducto">
                        <p:commandButton value="SI" icon="ui-icon-check"
                                         update="" ajax="true"
                                         actionListener="#{productoFormBean.eliminar()}" />
                        <p:commandButton value="NO" icon="ui-icon-closethick"
                                         oncomplete="PF('confirmarBajaProducto').hide()" />
                    </p:confirmDialog>

                </h:form>

                <!-- **************************************POPUP ALTA************************************************ -->

                <p:dialog widgetVar="widNuevoProducto" header="Nueva Producto" modal="true">
                    <h:form id="frmNuevo">
                        <p:panelGrid columns="2" id="pnlgProducto">

                            <p:outputLabel value="Descripcion:"/>
                            <p:inputText value="#{productoFormBean.pb.producto.descripcion}"/>

                            <p:commandButton value="Aceptar" icon="ui-icon-check"
                                             update=":frmProducto :frmProducto:growlProducto" ajax="true"
                                             actionListener="#{productoFormBean.guardar()}" />
                            <p:commandButton value="Cancelar" icon="ui-icon-closethick"
                                             oncomplete="PF('widNuevoProducto').hide()" />

                        </p:panelGrid>
                    </h:form>
                </p:dialog>


            </ui:define>

        </ui:composition>

    </h:body>
</html>
